# Task1

针对 Task 1 的粉丝投票估算模型，这是一个典型的 **反问题 (Inverse Problem)** 或 **隐变量推断 (Latent Variable Inference)** 问题。本质上，我们需要在给定观测数据（评委打分、淘汰结果）的情况下，推断未观测参数（粉丝投票份额）的后验分布。

因此，本研究建立了一个 **贝叶斯统计推断 (Bayesian Statistical Inference)** 框架：
1.  **先验 (Prior)**：假设投票分布服从狄利克雷分布（Dirichlet Distribution）。
2.  **似然/约束 (Likelihood/Constraint)**：利用历史淘汰结果作为硬性约束（Hard Constraints）。

由于直接计算后验概率密度的解析解极为困难，我们采用 **蒙特卡洛模拟** 结合 **拒绝采样** 的数值方法进行求解。这种方法在统计学中也被归类为 **近似贝叶斯计算(ABC)**。我们通过大量随机生成符合先验的投票样本，并“拒绝”掉所有与历史事实（谁被淘汰、决赛排名）相悖的样本，最终保留下来的样本集合即代表了最接近真实的投票分布情况。

## 主要假设

- **粉丝总票数为常数**：基于我们的背景调研，尽管节目早期观众基数大，但是当时投票手段单一，如电话，而后期观众基数减少，但改为数字化在线投票，且偶尔存在网红刷票行为，可认为投票上涨与下落抵消，总数是一个相对稳定的常数。另外，据近期的数据，最近一个季度的周平均总票数约为 14M，因此取这个数据。为简化计算、便于横向比较，我们在将各选手得票比例转化为票数时，将应用此常数。
- **投票分布服从狄利克雷分布**：设一周中所有选手的投票分布服从狄利克雷分布。由于需要估算所有 $N$ 位选手在总票池中的份额 $\mathbf{x} = (x_1, ..., x_N)$，且满足 $\sum x_i = 1, x_i > 0$。狄利克雷分布是单纯形上概率分布的自然共轭先验，适合描述“份额”分配问题。
- **现场表现与选手人气的混合效应**：粉丝投票并非完全盲目随机的，而是受选手的“基础人气”和“当周评委打分”共同驱动，并假设期望得票率是两者的线性组合。我们假设每位名人在一个赛季中拥有一个相对稳定的“基础人气值” (Base Popularity)，而评委分数则反映了其舞台表现对观众投票的即时影响。我们引入一个权重参数 $\lambda$ 来平衡两者的贡献，暂设置 $\lambda=0.2$，即20%的投票受当晚表现影响，80%受人气影响。
- **评委救援机制**：在28季度及往后，评委救援环节中，假设评委进行选择时倾向于保留当周表现分即第一轮评分更高的一组，用已知得分来替代最终选择结果，简化模型。

## 模型构建与求解步骤

本模型采用 **近似贝叶斯计算 (ABC, Approximate Bayesian Computation)** 框架下的拒绝采样法，结合 **迭代优化 (Iterative Refinement)** 算法，主要分为两个阶段：

### 1. 核心数学模型：混合先验 (Mixture Prior)
我们定义第 $t$ 周选手 $i$ 的粉丝得票率期望 $E[\text{Share}_{i,t}]$ 由两部分组成：
$$ E[\text{Share}_{i,t}] = (1 - \lambda) \cdot \text{BasePop}_i + \lambda \cdot \text{NormJudgeScore}_{i,t} $$
其中：
- $\text{BasePop}_i$: 选手 $i$ 的潜在基础人气（全赛季固定）。
- $\text{NormJudgeScore}_{i,t}$: 选手 $i$ 在第 $t$ 周评委分数的归一化占比。
- $\lambda$: 表现权重系数（本模型取 $\lambda=0.2$），意味着投票有20%受当晚表现影响，80%受明星的粉丝基础影响。

### 2. 第一阶段：全局基础人气求解 (Global Solver)
这是一个“反问题”求解过程。我们需要找到一组 $\mathbf{BasePop}$ 向量，使得在整个赛季的所有周次中，产生的模拟投票都能大概率满足“淘汰/幸存”的约束。
- **初始化**：所有选手的基础人气初始化为均匀分布。
- **迭代更新 (Iterative Epochs)**：
    1.  **正向采样**：在每一周，利用当前的 $\mathbf{BasePop}$ 和当周评委分构造混合先验，生成数千组可能的投票样本。
    2.  **约束检查 (Constraint Check)**：
        -   **常规周**：检查样本是否导致了历史上真实的淘汰结果（如：是否被淘汰者的总得分确实最低）。
        -   **决赛周**：检查样本生成的总排名是否与决赛真实名次 (Placement) 严格一致（如：冠军总分 > 亚军总分）。
    3.  **反向解耦 (De-mixing Update)**：对所有满足约束的“可行样本”，计算其平均得票率（后验均值）。然后通过逆向公式剔除评委分数的影响，还原出纯粹的基础人气：
        $$ \text{ImpliedBase}_i \approx \frac{\text{PosteriorMean}_{i} - \lambda \cdot \text{JudgeShare}_{i}}{1 - \lambda} $$
    4.  **聚合**：将整个赛季所有周次反推出的 $\text{ImpliedBase}$ 进行加权平均，作为下一轮迭代的 $\mathbf{BasePop}$。
- **收敛**：经过多轮迭代，$\mathbf{BasePop}$ 收敛至一组能最大程度解释整个赛季淘汰逻辑的稳定值，将其保存为基础人气值。

### 3. 第二阶段：周次得票率推断 (Final Inference)
在求得稳定的基础人气后，我们对其进行最终的蒙特卡洛模拟，以量化每一步的不确定性。
- **输入**：从第一阶段获得的最优 $\mathbf{BasePop}$。
- **模拟**：对每一周，再次构造混合先验分布，生成大量 ($N=20,000$) 随机投票样本。
- **筛选**：严格保留通过历史淘汰/排名约束的样本。
- **统计**：计算保留样本的均值（作为最终估算得票率）、标准差（Std Dev）和 95% 置信区间。

### 4. 不确定性度量 (Metrics)
我们构建了两个指标来评估估算结果的可靠性：
- **一致性 (Consistency)**：
  我们在计算出最终的推荐得票率（即所有可行样本的均值）后，将其代入当周的判分规则进行反向验证。若模型预测的最终得票率与评委分结合后，计算出的淘汰人选/排名顺序与历史事实完全相符，则记为一致（Consistent）。计算所有周的一致性占比，用来度量整体估测的一致性水平。

- **确定性 (Certainty) - 变异系数 (CV)**：
  $$ CV = \frac{\text{Standard Deviation}}{\text{Mean Estimated Share}} $$
  
  用 CV 值来度量模型估计的确定性，两者应呈现负相关。CV 值越低，说明在满足淘汰规则的前提下，该选手的得票率波动范围很小，我们可以非常确定他的得票情况（通常出现在处于淘汰边缘或拥有极高人气的选手中）。反之，CV 值高说明该选手的名次对票数不敏感，存在较大的猜测空间。
  
  我们的模型在设定好最终的参数后得到估算结果，根据标准差计算CV值，可以发现每一周、每个选手的预测结果的CV值大多有所差异，并非keep the same。做一个统计，考虑所有CV值度量计算平均值$$CV_{mean}=0.4615$$，在正常方位内，说明预测确定性较好。

## 方法的优点

1. **排除“幸存者偏差”**：本模型通过全局求解器，会从选手的整体季度表现去推断其基础人气，如：一名选手在前几周也排名靠前，可以利用选手在决赛周的高排名或多次幸存的经历，推高其基础人气从而进行解释，保证每个赛季早期的预估得票率更加合理。
2. **结合常识的混合机制**：引入 $\lambda$ 参数，减少模型得出“表现极差但得票极高”的极端结论，承认评委打分对拉票的正面作用，增强了模型的可解释性。
3. **严格的决赛序贯约束**：不同于常规周仅通过“最低分”判断是否淘汰，模型在决赛周引入全排列约束，迫使冠亚季军的得票率必须按序排列，显著提高了对头部选手估算的精度。
4. **黑箱友好与灵活适配**：该框架无需推导复杂的概率逆函数，并在代码中用一个函数就适配不同赛季的规则变化。

## 总结
通过上述模型，我们成功还原了34个赛季的周次得票数据，并生成了包含置信区间和变异系数的详细数据集，为后续比较不同计票规则的公平性奠定了坚实的数据基础。

图表：
1. 选手各周的投票率、得分变化
选取第二季度的第一名与第二名选手，包含争议性选手 Jerry Rice
[图片]
2. 一周的各选手投票与评分占比（Season 2 的决赛数据）
[图片]
3. 评委评分与观众投票：综合结果对应的赛果统计（淘汰与否）
[图片]

表格：
1. 选手基础人气
[表格]
2. 计算得票率之后的数据汇总
[表格]
